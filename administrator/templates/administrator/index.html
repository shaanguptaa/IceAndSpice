{% load static %}
{% load humanize %}

<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <title>Admin &ndash; Restaurant</title>
  <link rel="stylesheet" href="{% static 'css/bootstrap/bootstrap.css' %}">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css" />
  <!-- Google Fonts Roboto -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" />

    <link rel="stylesheet" href="{% static 'fonts/ionicons/css/ionicons.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/magnific-popup.css' %}">

    <link rel="stylesheet" href="{% static 'fonts/fontawesome/css/font-awesome.min.css' %}">
    
    
    <link rel="stylesheet" href="{% static 'css/slick.css' %}">

    <link rel="stylesheet" href="{% static 'css/helpers.css' %}">
  <!-- MDB -->
  <link rel="stylesheet" href="{% static 'admin/css/mdb.min.css' %}" />
  <!-- Custom styles -->
  <link rel="stylesheet" href="{% static 'admin/css/admin.css' %}" />
  <link rel="stylesheet" href="{% static 'css/bootstrap-multiselect.min.css' %}" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js" integrity="sha512-d9xgZrVZpmmQlfonhQUvTR7lMPtO7NkZMkA0ABN3PHCbKA5nqylQ/yWlFAyY6hYgdF1Qh6nYiuADWwKB4C2WSw=="
    crossorigin="anonymous"></script>

  <style type="text/css">
    body{
      overflow-x: hidden; 
    }
    .sidebar-right {
      position: fixed;
      float: right;
      top: 0;
      bottom: 0;
      right: 0;
      box-shadow: 0 2px 5px 0 rgb(0 0 0 / 5%), 0 2px 10px 0 rgb(0 0 0 / 5%);
      width: 30px;
      z-index: 700;
    }

    .list-group-item {
      padding-top: 15px !important;
      padding-bottom: 15px !important;
    }

    .welcome {
      font-size: 40px;
      font-family: sans-serif;
      padding-bottom: 10px;
      padding-left: 5px;
    }

   input[type=number] {
      -moz-appearance: textfield !important;
    }

    .add-item {
      color: black;
      float: right;
      margin-right: 20px;
      margin-top: -22px;
      padding-left: 10px;
      padding-right: 10px;

    }

    .feedback-card:hover, .feedback-card:active {
      background-color: rgba(0, 0, 0, 0.1);
    }

    #load-more-feedbacks:hover, #load-more-feedbacks:active {
      color: blue;
    }

    #section-profile {
      display: none;
      position: fixed;
      padding: 0px;
      margin: 0px;
      z-index: 900;
      top: 0px;
      right: 0px;
      width: 80%;
      height: 100% ;
      background-color: #f7faff;
    }

    .signout {
      border-top: 1px solid rgba(79, 79, 79, 0.3) !important;
      border-bottom: 1px solid rgba(79, 79, 79, 0.3) !important;
    }

    .card {
      border-radius: 15px;
    }

    #section-menu table tr {
      cursor: pointer;
    }

    .feedback-email {
      font-size: medium;
      font-weight: normal;
      color: black;
    }

    #table-reservation tbody tr, #table-order tbody tr, #table-offers tbody tr {
      cursor: pointer;
    }

    .fractions {
      letter-spacing: -.5ch;
      /* display: inline-block !important; */
      /* padding: 0px !important;
      margin-left: 0px !important;
      margin-right: 0px !important; */
    }

    .numerator {
      vertical-align: top;
    }

    .divide-sign {
      font-size: 2.7ch;
    }

    .denominator {
      vertical-align: bottom;
    }

    .multiselect-filter, .multiselect-all {
      margin: 5px 0;
    }

    .multiselect-group {
      text-transform: capitalize;
      font-weight: bold;
      cursor: pointer;
    }

    .form-check-label {
      padding-left: 0px;
    }

    #table-offers tbody td.items {
      text-overflow: ellipsis ellipsis;
      overflow: hidden;
      white-space: no-wrap;
    }

  </style>
</head>

<body>
  <!--Main Navigation-->
  <header>
    <!-- Sidebar -->
    <nav id="sidebarMenu" class="collapse d-lg-block sidebar collapse bg-white">
      <div class="position-sticky">
        <div class="list-group list-group-flush mx-3 mt-4">
          <!-- Brand -->
          <a class="navbar-brand" href="/" style="justify-content: center;">
            <img src="{% static 'images/restaurant/logo.png' %}" height="30" alt="logo" loading="lazy" />
          </a>
          <hr>
          <a href="#" class="list-group-item list-group-item-action py-2 ripple" style="margin-top: -15px !important;" aria-current="true">
            <i class="fas fa-tachometer-alt fa-fw me-3"></i><span>Main dashboard</span></a>

          <a href="#section-reservations" class="list-group-item list-group-item-action py-2 ripple">
            <i class="fas fa-clock fa-fw me-3"></i><span>Reservations</span></a>

          <a href="#section-menu" class="list-group-item list-group-item-action py-2 ripple">
            <i class="fas fa-book-open fa-fw me-3"></i><span>Menu</span></a>

          <a href="#section-orders" class="list-group-item list-group-item-action py-2 ripple"><i
              class="fas fa-clipboard-list fa-fw me-3"></i><span>Orders</span></a>
          
          <a href="#section-offers" class="list-group-item list-group-item-action py-2 ripple"><i
            class="fas fa-clipboard-list fa-fw me-3"></i><span>Offers</span></a>

          <a href="#section-feedback" class="list-group-item list-group-item-action py-2 ripple"><i
              class="fas fa-user-friends fa-fw me-3"></i><span>Customer Reviews</span></a>

          <a href="#section-profile" id="profile" class="list-group-item list-group-item-action py-2 ripple">
            <i class="fas fa-user-circle fa-fw me-3"></i><span>Profile</span></a>

          <a href="logout" class="signout list-group-item list-group-item-action py-2 ripple">
            <i class="fas fa-sign-out-alt fa-fw me-3"></i><span>Sign Out</span></a>
        </div>
      </div>
    </nav>
    <!-- Sidebar -->
  </header>
  <!--Main Navigation-->

  <!--Main layout-->
  <main >
    <div class="container pt-5" >
      <h1 class="welcome text-muted">Welcome, {% if user.first_name %} {{user.first_name}} {% else %} {{user.username}} {% endif %}</h1>
      
      
      <!-- Overview section -->
      <section class="mb-4" id="section-overwiew">
        <div class="row mt-5">
          <div class="col-sm-6">
            <div class="card" id="orders-delivered">
              <div class="card-body">
                <h5 class="card-title text-muted">Orders Delivered</h5>
                <div class="card-text m-3" style="font-size: 40px;">
                  <span>0</span>
                </div>
                <p class="card-text text-muted" style="font-size: small;">Since Today Morning</p>
              </div>
            </div>
          </div>
          <div class="col-sm-6">
            <div class="card" id="orders-pending">
              <div class="card-body">
                <h5 class="card-title text-muted">Orders Pending</h5>
                <div class="card-text m-3" style="font-size: 40px;">
                  <span>0</span>
                </div>
                <p class="card-text text-muted" style="font-size: small;">Since Today Morning</p>
              </div>
            </div>
          </div>
        </div>

        <div class="row mt-5">
          <div class="col-sm-6">
            <div class="card" id="upcoming-reservations">
              <div class="card-body">
                <h5 class="card-title text-muted">Upcoming Reservations</h5>
                <div class="card-text m-3" style="font-size: 40px;">
                  <span>0</span>
                </div>
                <p class="card-text text-muted" style="font-size: small;">For Today</p>
              </div>
            </div>
          </div>
          <div class="col-sm-6">
            <div class="card" id="tables-booked">
              <div class="card-body">
                <h5 class="card-title text-muted">Tables Booked</h5>
                <div class="card-text m-3" style="font-size: 40px;">
                  <span>0</span>
                </div>
                <p class="card-text text-muted" style="font-size: small;">Since Today Morning</p>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- overview section end -->



      <!-- section menu -->
      <section class="mb-4 " id="section-menu" style="padding-top: 30px;">
        <div class="card">
          <div class="card-header text-center py-3">
            <h5 class="text-center mt-3">
              <strong>Menu Items</strong>
              <button class="add-item btn btn-success" style="margin-top: -7px;" id="add-item" data-toggle="modal" data-target="#add-menu-item">
                <i class="far fa-plus-square"></i>&nbsp; Add Item</button>
            </h5>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover text-nowrap" style="margin-top: -20px;">
                <thead>
                  <tr>
                    <!-- <th scope="col">Product ID</th> -->
                    <th scope="col">Item Name</th>
                    <th scope="col">Category</th>
                    <th scope="col">Status</th>
                    <th scope="col">Price</th>
                  </tr>
                </thead>
                <tbody>
                  {% for item in menu %}
                    <tr id="{{ item.id }}">
                      <td class="item-name">{{ item.item_name }}</td>
                      <td class="item-cat">{{ item.category }}</td>
                      <td class="item-status">{% if item.status == "IN" %}In Stock{% elif item.status == "OUT" %}Out of Stock{% endif %}</td>
                      <td class="item-price">&#x20B9; {{ item.price|intcomma }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
      <!-- menu section end -->

      <!-- edit menu modal -->
      <div id="edit-menu-item" class="modal fade" role="popup">
        <div class="modal-dialog modal-dialog-centered modal-md">

          <!-- Modal content-->
          <div class="modal-content justify-content-center">
            <div class="modal-header">
              <h4 class="modal-title">Item Details:</h4>
              <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
              <form method="POST" id="edit-item-form">
                {% csrf_token %}
                <div class="row">
                  <div class="col-md-4">
                    <div class="form-group">
                      <label for="pid">Item ID: </label>
                      <input type="text" name="pid" id="pid" class="form-control" readonly>
                    </div>
                  </div>
                  <div class="col-md-8">
                    <div class="form-group">
                      <label for="pname">Item Name: </label>
                      <input type="text" name="pname" id="pname" class="form-control" required>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-4">
                    <div class="form-group">
                      <label for="pcat">Category: </label>
                      <select name="pcat" id="pcat" class="form-control" required>
                        <option class="form-control" value="Main">Main</option>
                        <option class="form-control" value="Drinks">Drinks</option>
                        <option class="form-control" value="Desserts">Desserts</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-group">
                      <label for="pstat">Status: </label>
                      <select name="pstat" id="pstat" class="form-control" required>
                        <option class="form-control" value="IN">In Stock</option>
                        <option class="form-control" value="OUT">Out of Stock</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-group">
                      <label for="p_price">Price: </label>
                      <input type="number" name="p_price" id="p_price" min="1" class="form-control" required>
                    </div>
                  </div>
                </div>
                <div class="form-group" style="float: right; padding-top: 10px;">
                  <input type="button" name="delete" id="delete" value="Delete" class="btn btn-danger" style=" margin-right: 20px;">
                  <input type="submit" name="save" id="save" value="Save" class="btn btn-success" style=" margin-right: 20px;">
                </div>
              </form>
            </div>
          </div>

        </div>
      </div>

      <!-- add menu modal -->
      <div id="add-menu-item" class="modal fade" role="popup">
        <div class="modal-dialog modal-dialog-centered modal-md">

          <!-- Modal content-->
          <div class="modal-content justify-content-center">
            <div class="modal-header" style="padding-bottom: 0px;">
              <div>
                <h4 class="modal-title">Add Item:</h4>
                <p style="font-size: 15px;">Enter the details below to add a new item in the menu.</p>
              </div>
              <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
              <form id="add-item-form" method="POST">
                <div class="row">
                  <div class="col-md-12">
                    <div class="form-group">
                      <label for="pname">Item Name: </label>
                      <input type="text" name="pname" id="pname" class="form-control" required>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-4">
                    <div class="form-group">
                      <label for="pcat">Category: </label>
                      <select name="pcat" id="pcat" class="form-control" required>
                        <option class="form-control" value="Main">Main</option>
                        <option class="form-control" value="Drinks">Drinks</option>
                        <option class="form-control" value="Desserts">Desserts</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-group">
                      <label for="pstat">Status: </label>
                      <select name="pstat" id="pstat" class="form-control" required>
                        <option class="form-control" value="IN">In Stock</option>
                        <option class="form-control" value="OUT">Out of Stock</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-group">
                      <label for="p_price">Price: </label>
                      <input type="number" name="p_price" id="p_price" min="1" class="form-control" required>
                    </div>
                  </div>
                </div>
                <div class="form-group" style="float: right; padding-top: 10px;">
                  <input type="button" value="Cancel" class="btn btn-danger" data-dismiss="modal" style=" margin-right: 20px;">
                  <input type="submit" name="add" id="add" value="Add Item" class="btn btn-success" style=" margin-right: 20px;">
                </div>
              </form>
            </div>
          </div>

        </div>
      </div>



      <!-- reservation section  -->
      <section class="mb-4 " id="section-reservations">
        <div class="card">
          <div class="card-header text-center py-3">
            <h5 class="mb-0 text-center">
              <strong>Recent Reservations</strong>
            </h5>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover text-nowrap" id="table-reservation" style="margin-top: -20px;">
                <thead>
                  <tr>
                    <th scope="col">Name</th>
                    <th scope="col">Date</th>
                    <th scope="col">Time</th>
                    <th scope="col">Persons</th>
                    <th scope="col">Status</th>
                  </tr>
                </thead>
                <tbody>
                  {% for reservation in reservations %}
                    <tr id="{{reservation.id}}">
                      <td>{{reservation.name}}</td>
                      <td>{{reservation.date_of_reservation|date:"SHORT_DATE_FORMAT"}}</td>
								    	<td>{{reservation.date_of_reservation|time:"TIME_FORMAT"}}</td>
                      <td>{{reservation.persons}}</td>
                      {% if reservation.status == "P" %}
										    <td class="text-warning"><span><i class="fa fa-clock-o"></i></span> Pending</td>
                      {% elif reservation.status == "R" %}
                        <td class="text-success"><span><i class="far fa-check-circle"></i></span> Reserved</td>
                      {% elif reservation.status == "C" %}
                        <td class="text-danger"><span><i class="far fa-times-circle"></i></span> Cancelled</td>
                      {% endif %}
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
      <!-- Reservation Section end -->

      <!-- reserve model -->
      <div id="reserveModal" class="modal fade" role="dialog">
        <div class="modal-dialog modal-dialog-centered modal-lg">
      
          <!-- Modal content-->
          <div class="modal-content justify-content-center">
          <div class="modal-header">
            <h4 class="modal-title pl-1">Reservation Details <span id="r-id"></span></h4>
            <button type="button" class="close close-btn" data-dismiss="modal">&times;</button>
          </div>
      
          <div class="modal-body">
            <div class="row">
              <div class="col-md-6 justify-content-center form-group" style="float: left;">
                <label for="reserve-date">Reservation Date: &nbsp;</label>
                <input id="reserve-date" name="reserve-date" type="date" class="pl-3 form-control" value="" readonly></input>
              </div>
              <div class="col-md-6 justify-content-center form-group" style="float: right;">
                <label for="reserve-time">Reservation Time: &nbsp;</label>
                <input id="reserve-time" name="reserve-time" type="time" class="pl-3 form-control" value="" readonly></input>
              </div>
            </div>
      
            <div class="row">
              <div class="col-md-6 justify-content-center form-group" style="float: left;">
                <label for="reserve-booking">Booked on: &nbsp;</label>
                <input id="reserve-booking" name="reserve-booking" type="datetime-local" class="pl-3 form-control" value="" readonly></input>
              </div>
              <div class="col-md-6 justify-content-center form-group" style="float: right;">
                <label for="reserve-num-persons">Number of Persons: &nbsp;</label>
                <input id="reserve-num-persons" name="reserve-num-persons" class="pl-3 form-control" value="" readonly></input>
              </div>
            </div>
          </div>
          <!-- <hr style="margin-bottom: 0;"> -->
          <div class="modal-header" style="border-top: 1px solid #e9ecef;">
            <h4 class="modal-title pl-1">Customer Details</h4>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-6 justify-content-center form-group" style="float: left;">
                <label for="reserve-name">Name: &nbsp;</label>
                <input id="reserve-name" name="reserve-name" class="pl-3 form-control" value="" readonly></input>
              </div>
              <div class="col-md-6 justify-content-center form-group" style="float: right;">
                <label for="reserve-phone">Contact: &nbsp;</label>
                <input id="reserve-phone" name="reserve-phone" class="pl-3 form-control" value="" readonly></input>
              </div>
            </div>
      
            <div class="row">
              <div class="col-md-6 justify-content-center form-group" style="float: left;">
                <label for="reserve-email">Email: &nbsp;</label>
                <input id="reserve-email" name="reserve-email" class="pl-3 form-control" value="" readonly></input>
              </div>
              <!-- <div class="col-md-6 justify-content-center form-group" style="float: right;">
                <label for="reserve-address">Address: &nbsp;</label>
                <input id="reserve-address" name="reserve-address" class="pl-3 form-control" value="" readonly></input>
              </div> -->
            </div>
          </div>

          <div class="modal-footer">
            <div class="container">
            <h4 id="reserve-status" style="float: left;"></h4>
            <button style="float: right;" id="confirm-reservation-btn" class="btn btn-success">Confirm Reservation</button>
            <button style="float: right;" id="cancel-reservation-btn" class="btn btn-danger mr-3">Cancel Reservation</button>
            </div>
          </div>
          </div>
      
        </div>
      </div>
      <!-- END reserve Modal -->



      <!-- Orders Section -->
      <section class="mb-4 " id="section-orders" style="padding-top: 30px;">
        <div class="card">
          <div class="card-header text-center py-3">
            <h5 class="mb-0 text-center">
              <strong>Recent Orders</strong>
            </h5>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover text-nowrap" id="table-order" style="margin-top: -20px;">
                <thead>
                  <tr>
                    <!-- <th scope="col">Order</th> -->
                    <th scope="col">Customer Name</th>  
                    <th scope="col">Location</th>
                    <th scope="col">Items</th>
                    <th scope="col">Status</th>
                  </tr>
                </thead>
                <tbody>
                  {% for order in orders %}
                    <tr id="{{order.id}}">
                      <td>{{order.name}}</td>
                      <td>{{order.location}}</td>
                      <td>{{order.items|truncatewords:10}}</td>
                      {% if order.status == "P" %}
										    <td class="text-warning"><span><i class="fa fa-clock-o"></i></span> Pending</td>
                      {% elif order.status == "D" %}
                        <td class="text-success"><span><i class="far fa-check-circle"></i></span> Delivered</td>
                      {% elif order.status == "N" %}
                        <td class="text-success"><span><i class="far fa-check-circle"></i></span> Confirmed</td>
                      {% elif order.status == "C" %}
                        <td class="text-danger"><span><i class="far fa-times-circle"></i></span> Cancelled</td>
                      {% endif %}
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
      <!-- orders section end -->

      <!-- order model -->
      <div id="orderModal" class="modal fade" role="dialog">
        <div class="modal-dialog modal-dialog-centered modal-lg">
      
          <!-- Modal content-->
          <div class="modal-content justify-content-center">
          <div class="modal-header">
            <h4 class="modal-title pl-1">Order Details <span id="o-id"></span></h4>
            <button type="button" class="close close-btn" data-dismiss="modal">&times;</button>
          </div>
      
          <div class="modal-body">
            <table class="table table-hover table-sm" id="table-order">
              <thead>
              <tr>
                <th style="text-align: center;">Item Name</th>
                <th style="text-align: center;">Quantity</th>
                <th style="text-align: center;"></th>
                <th style="text-align: center;">Price</th>
              </tr>
              </thead>
              <tbody>
                <!-- Items list fetched from server using ajax -->
              </tbody>
            </table>
          </div>
          <hr style="margin-bottom: 0;">
          <div class="modal-header">
            <h4 class="modal-title pl-1">Delivery Details</h4>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-6 justify-content-center form-group" style="float: left;">
                <label for="personName">Name: &nbsp;</label>
                <input id="personName" name="personName" class="pl-3 form-control" value="" readonly></input>
              </div>
              <div class="col-md-6 justify-content-center form-group" style="float: right;">
                <label for="order-phone">Contact: &nbsp;</label>
                <input id="order-phone" name="order-phone" class="pl-3 form-control" value="" readonly></input>
              </div>
            </div>
      
            <div class="row">
              <div class="col-md-6 justify-content-center form-group" style="float: left;">
                <label for="order-email">Email: &nbsp;</label>
                <input id="order-email" name="order-email" class="pl-3 form-control" value="" readonly></input>
              </div>
              <div class="col-md-6 justify-content-center form-group" style="float: right;">
                <label for="order-address">Address: &nbsp;</label>
                <input id="order-address" name="order-address" class="pl-3 form-control" value="" readonly></input>
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <div class="container">
            <!-- <input style="float: left;" type="button" name="viewBill" id="viewBill" class="btn pb-3 btn-primary ml-5" value="View Bill"> -->
            <h4 id="delivery-status" style="float: left;"></h4>
            <button style="float: right;" id="confirm-order-btn" class="btn btn-success">Confirm Order</button>
            <button style="float: right;" id="deliver-order-btn" class="btn btn-success">Deliver Order</button>
            <button style="float: right;" id="cancel-order-btn" class="btn btn-danger mr-3">Cancel Order</button>
            </div>
          </div>
          </div>
      
        </div>
      </div>
      <!-- END Order Modal -->

      
      <!-- Offers Section -->
      <section class="mb-4 " id="section-offers" style="padding-top: 30px;">
        <div class="card">
          <div class="card-header text-center py-3">
            <h5 class="mb-0 text-center">
              <strong>Offers & Discounts</strong>
            </h5>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover text-nowrap" id="table-offers" style="margin-top: -20px;">
                <thead>
                  <tr>
                    <th scope="col">Coupon Code</th>  
                    <th scope="col">Discount</th>
                    <th scope="col">Available on</th>
                    <th scope="col">Valid Upto</th>
                  </tr>
                </thead>
                <tbody>
                  {% for offer in offers %}
                    <tr id="{{offer.coupon_code}}">
                      <td class="code">{{offer.coupon_code}}</td>
                      <td class="discount">{{offer.discount_percent}} %</td>
                      <td class="items">{{offer.items}}</td>
                      {% if offer.is_expired %}
                        <td class="text-danger expiry_date"><span><i class="fa fa-times"></i></span> Expired</td>
                      {% else %}
                        <td class="text-success expiry_date"><span><i class="fa fa-check"></i></span> {{offer.expiry_date}}</td>
                      {% endif %}
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
      <!-- END Offers Section -->


      <!-- edit offer modal -->
      <div id="edit-offer-modal" class="modal fade" role="popup">
        <div class="modal-dialog modal-dialog-centered modal-md">

          <!-- Modal content-->
          <div class="modal-content justify-content-center">
            <div class="modal-header">
              <h4 class="modal-title">Offer Details:</h4>
              <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
              <form method="POST" id="edit-offer-form">
                {% csrf_token %}
                <div class="row">
                  <div class="col-md-4">
                    <div class="form-group">
                      <label for="code">Coupon Code: </label>
                      <input type="text" name="code" id="code" class="form-control" required>
                    </div>
                  </div>
                  <div class="col-md-8">
                    <div class="form-group">
                      <label for="title">Title: </label>
                      <input type="text" name="title" id="title" class="form-control" required>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md">
                    <div class="form-group">
                      <label for="desc">Description: </label>
                      <textarea name="desc" id="desc" cols="30" rows="3" class="form-control"></textarea>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="offer-items">Available for:</label><br>
                      <select id="offer-items" name="offer-items" class="form-control" multiple="multiple" >
                        {% for category, items in menu_items.items %}
                          <optgroup label="{{category}}" style="text-transform: capitalize;">
                            {% for item in items %}
                              <option value="{{item.id}}">{{item.item_name}}</option>
                            {% endfor %}
                          </optgroup>
                        {% endfor %}
                        </select>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="discount">Discount: </label>
                      <input type="number" name="discount" id="discount" min="1" max="100" class="form-control" required>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="expiry_date">Valid Upto: </label>
                      <input type="date" name="expiry_date" id="expiry_date" class="form-control" required>
                    </div>
                  </div>
                </div>
                <div class="form-group" style="float: right; padding-top: 10px;">
                  <input type="button" name="delete" id="delete" value="Delete" class="btn btn-danger" style=" margin-right: 20px;">
                  <input type="submit" name="save" id="save" value="Save" class="btn btn-success" style=" margin-right: 20px;">
                </div>
              </form>
            </div>
          </div>

        </div>
      </div>


      <!-- add offer modal -->
      <div id="add-offer-modal" class="modal fade" role="popup">
        <div class="modal-dialog modal-dialog-centered modal-md">

          <!-- Modal content-->
          <div class="modal-content justify-content-center">
            <div class="modal-header" style="padding-bottom: 0px;">
              <div>
                <h4 class="modal-title">Add Offer:</h4>
                <p style="font-size: 15px;">Enter the details below to add a new offer.</p>
              </div>
              <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
              <form id="add-item-form" method="POST">
                <div class="row">
                  <div class="col-md-12">
                    <div class="form-group">
                      <label for="pname">Offer Title: </label>
                      <input type="text" name="pname" id="pname" class="form-control" required>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-4">
                    <div class="form-group">
                      <label for="pcat">Category: </label>
                      <select name="pcat" id="pcat" class="form-control" required>
                        <option class="form-control" value="Main">Main</option>
                        <option class="form-control" value="Drinks">Drinks</option>
                        <option class="form-control" value="Desserts">Desserts</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-group">
                      <label for="pstat">Status: </label>
                      <select name="pstat" id="pstat" class="form-control" required>
                        <option class="form-control" value="IN">In Stock</option>
                        <option class="form-control" value="OUT">Out of Stock</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-group">
                      <label for="o_discount">Discount: </label>
                      <input type="number" name="o_discount" id="o_discount" min="1" max="100" class="form-control" required>
                    </div>
                  </div>
                </div>
                <div class="form-group" style="float: right; padding-top: 10px;">
                  <input type="button" value="Cancel" class="btn btn-danger" data-dismiss="modal" style=" margin-right: 20px;">
                  <input type="submit" name="add" id="add" value="Add Offer" class="btn btn-success" style=" margin-right: 20px;">
                </div>
              </form>
            </div>
          </div>

        </div>
      </div>


      <!-- Feedbacks section -->
      <section class="mb-4" id="section-feedback" style="padding-top: 30px;">
        <div class="card">
          <div class="card-header text-center py-3 "><h5 class="mb-0"><strong>Customer Feedbacks</strong></h5></div>
        </div>

        {% for feedback in feedbacks %}
          <div class="card feedback-card my-3" style="border-bottom: 1px solid gray;">
            <div class="card-body" style="padding-left: 20px; padding-right: 20px;">
              <div class="row" style="padding-bottom: 10px;">
                <span class="col-1" style="font-size: 15px; padding-left: 20px;"><i class="far fa-2x fa-user-circle"></i></span>
                <h5 class="col-8" style="padding-top: 5px;">{{ feedback.name }} <a class="feedback-email" href="mailto:{{feedback.email}}?subject=Reply to your feedback on IceAndSpice.com">< {{feedback.email}} ></a></h5>
                <span class="col-3 pr-5" style="padding-top: 5px; text-align: right;"><i class="far fa-calendar-alt"></i>&nbsp; {{ feedback.feedback_date|naturaltime }}</span>
              </div>
              <div class="row">
                <p class="pr-5" style="padding-left: 90px; text-align: justify;">{{ feedback.message }}</p>
              </div>
            </div>
          </div>
        {% endfor %}
      </section>
      <!-- feedbacks section end -->



      <!-- profile section -->
      <section class="mb-4" id="section-profile" style="padding-top: 30px;">
        <div class="container p-3">
          <form id="profile-form" method="POST">
            {% csrf_token %}
            <div class="row py-3">
              <div class="col-md-4 form-group">
                <label for="username" style="font-size: larger;">Username :</label>
                <input type="text" class="form-control" name="username" id="username" value="{{request.user.username}}">
              </div>
            </div>
            <div class="row py-3">
              <div class="col-md-4 form-group">
                <label for="fname" style="font-size: larger;">First Name :</label>
                <input type="text" class="form-control" name="fname" id="fname" value="{{request.user.first_name}}">
              </div>
              <div class="col-md-4 form-group">
                <label for="lname" style="font-size: larger;">Last Name :</label>
                <input type="text" class="form-control" name="lname" id="lname" value="{{request.user.last_name}}">
              </div>
            </div>
            <div class="row py-3">
              <div class="col-md-4 form-group">
                <label for="email" style="font-size: larger;">Email ID : </label>
                <input type="email" class="form-control" name="email" id="email" value="{{request.user.email}}">
              </div>
              <div class="col-md-4 form-group">
                <label for="phone" style="font-size: larger;">Phone : </label>
                <input type="number" class="form-control" name="phone" id="phone" value="{{request.user.profile.phone}}">
              </div>
            </div>
            <div class="row py-3">
              <div class="col-md-4 form-group">
                <a href="">Change Password</a>
              </div>
            </div>
            
            <div class="row py-3">
              <div class="col-8">
                <input type="submit" name="update" id="update-btn"  class="btn btn-success" style="float: right;" value="Save Changes">
                <input type="reset" name="reset" id="reset-btn"  class="btn btn-danger mr-3" style="float: right;" value="Reset">
              </div>
            </div>
          </form>
        </div>
      </section>
      <!-- profile section end -->
  </main>

  <!-- Notify Model -->
  <div class="modal fade" role="dialog" id="notify-modal">
		<div class="modal-dialog modal-dialog-centered modal-md">
		  <div class="modal-content justify-content-center">
  
			<div class="modal-header">
			  <h5 class="modal-title" id="notifyTitle">Reserved</h5>
			  <button type="button" class="close close-btn" data-dismiss="modal">&times;</button>
			</div>
  
			<div class="modal-body"></div>
  
			<div class="modal-footer">
			  <button type="button" class="btn btn-danger close-btn" data-dismiss="modal">Close</button>
			  <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
			</div>
		  </div>
		</div>
	</div>
  <!--Main layout-->
    <script src="{% static 'js/jquery.min.js' %}"></script>
    
    <script src="{% static 'js/popper.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/bootstrap-multiselect.min.js' %}"></script>


    <script src="{% static 'js/slick.min.js' %}"></script>
    <script src="{% static 'js/jquery.mb.YTPlayer.min.js' %}"></script>

    <script src="{% static 'js/jquery.waypoints.min.js' %}"></script>
    <script src="{% static 'js/jquery.easing.1.3.js' %}"></script>
    
    <script src="{% static 'js/jquery.magnific-popup.min.js' %}"></script>
    <script src="{% static 'js/magnific-popup-options.js' %}"></script>

  <!-- MDB -->
  <script type="text/javascript" src="{% static 'admin/js/mdb.min.js' %}"></script>
  <!-- Custom scripts -->
  <script type="text/javascript" src="{% static 'admin/js/admin.js' %}"></script>

  <script type="text/javascript">
		window.CSRF_TOKEN = "{{ csrf_token }}";

    $("#offer-items").multiselect({
      includeSelectAllOption: true,
      enableFiltering: true,
      enableCaseInsensitiveFiltering: true,
      // enableClickableOptGroups: true,

    });

    // function to show the profile details
    $(".list-group-item").click(function () {
      if($(this).attr('id') == "profile") {
        $("#section-profile").show();
      } else {
        $("#section-profile").hide();
      }

    });

    // ajax for showing item details in modal
    $('#section-menu table tbody tr').on('click', function () {
      $.ajax({
			type: "POST",
			url: "/menu/getItem/",
			data: {
				csrfmiddlewaretoken: window.CSRF_TOKEN,
				item_id: $(this).attr('id'),
				get_item: "True"},
			datatype: 'json',

			success: function(response) {
				if (response.status) {
          $("#edit-menu-item form #pid").val(response.item.id);
          $("#edit-menu-item form #pname").val(response.item.item_name);
          $("#edit-menu-item form #pcat").val(response.item.category);
          $("#edit-menu-item form #pstat").val(response.item.status);
          $("#edit-menu-item form #p_price").val(response.item.price);
					
					$("#edit-menu-item").modal('show');

				} else if (!response.status) {

				}
			},

			error: function (jqXHR, exception) {

				}
			})
    })

    // ajax for editing menu item
    $('#edit-item-form').submit(function () {
      $.ajax({
			type: "POST",
			url: "/menu/updateItem/",
			data: {
				csrfmiddlewaretoken: window.CSRF_TOKEN,
				id: $("#edit-item-form #pid").val(),
        name: $("#edit-item-form #pname").val(),
        category: $("#edit-item-form #pcat").val(),
        status: $("#edit-item-form #pstat").val(),
        price: $("#edit-item-form #p_price").val(),
				update_item: "True"},
			datatype: 'json',

			success: function(response) {
				if (response.status) {
          var tr = $("#section-menu table tbody tr#" + response.item.id);
          $('td.item-name', tr).html(response.item.item_name);
          $('td.item-cat', tr).html(response.item.category);
          if (response.item.status == "IN") {
            $('td.item-status', tr).html("In Stock");
          } else if (response.item.status == "OUT") {
            $('td.item-status', tr).html("Out of Stock");
          }
          $('td.item-price', tr).html("&#x20B9; " + response.item.price);
					
					$("#edit-menu-item").modal('hide');

				} else if (!response.status) {

				}
			},

			error: function (jqXHR, exception) {

				}
			});
      return false;
    })

    // ajax for deleting menu item
    $('#edit-item-form #delete').click(function () {
      $.ajax({
			type: "POST",
			url: "/menu/deleteItem/",
			data: {
				csrfmiddlewaretoken: window.CSRF_TOKEN,
				id: $("#edit-item-form #pid").val(),
				delete_item: "True"},
			datatype: 'json',

			success: function(response) {
				if (response.status) {
          $("#section-menu table tbody tr#" + response.item_id).remove();
					
					$("#edit-menu-item").modal('hide');

				} else if (!response.status) {

				}
			},

			error: function (jqXHR, exception) {

				}
			});
      return false;
    })


    // ajax for adding menu item
    $('#add-item-form').submit(function () {
      $.ajax({
			type: "POST",
			url: "/menu/addItem/",
			data: {
				csrfmiddlewaretoken: window.CSRF_TOKEN,
        name: $("#add-item-form #pname").val(),
        category: $("#add-item-form #pcat").val(),
        status: $("#add-item-form #pstat").val(),
        price: $("#add-item-form #p_price").val(),
				add_item: "True"},
			datatype: 'json',

			success: function(response) {
				if (response.status) {
          var tr = '<tr id="' + response.item.id + '">' +
                      '<td class="item-name">' + response.item.item_name + '</td>';
                      '<td class="item-cat">' + response.item.category + '</td>';
          if (response.item.status == "IN") {
            tr += '<td class="item-cat">In Stock</td>';
          } else if (response.item.status == "OUT") {
            tr += '<td class="item-cat">Out of Stock</td>';
          }
          
          tr += '<td class="item-price">&#x20B9; ' + response.item.price + '</td>' +
                '</tr>';
          
          $("#section-menu table tbody").prepend(tr);

					$("#add-menu-item").modal('hide');

				} else if (!response.status) {

				}
			},

			error: function (jqXHR, exception) {

				}
			});
      return false;
    })


    // toggle the save changes and reset btn
		$("#username, #fname, #lname, #email, #phone").on('input', function () {
			$("#update-btn").removeAttr('disabled');
		});
		$("#reset-btn").click(function () {
			$("#update-btn").attr('disabled', 'disabled');
		});

    // ajax for updating profile
    $("#profile-form").submit(function () {
			$("#update-btn").html('<i class="fas fa-circle-notch fa-spin"></i> Updating ...').attr('disabled', 'disabled');
			$.ajax({
				type: "POST",
				url: "/admin/save-changes/",
				// change the url when updating in index from test......................................................
				data: {
					csrfmiddlewaretoken: window.CSRF_TOKEN,
					username: $("#profile-form #username").val(),
          fname: $("#profile-form #fname").val(),
          lname: $("#profile-form #lname").val(),
          email: $("#profile-form #email").val(),
					phone: $('#profile-form #phone').val(),
					update_profile: true },
				datatype: 'json',

				success: function(response) {
					if (response.status) {
						$("#update-btn").html('Save Changes');
						$("#notify-modal #notifyTitle").html("Profile Updated");
						$("#notify-modal .modal-body").html("Profile Updated Successfully . . .");
						$("#notify-modal").modal("show");
					} else if (!response.status) {
						$("#update-btn").html('Save Changes').removeAttr('disabled');
						$("#notify-modal #notifyTitle").html("Error");
						$("#notify-modal .modal-body").html("Cannot Update Profile . . .");
						$("#notify-modal").modal("show");
					}
				},

				error: function (jqXHR, exception) {

				}
			})
      return false;
    });

    $(".close-btn").click(function () {
      $(this).closest(".modal").modal("hide")
    })
  
    // show details of reservation when clicked on the row
		$("#table-reservation tbody tr").on('click', function () {
			$.ajax({
			type: "POST",
			url: "/reservation/getReservationDetails/",
			data: {
				csrfmiddlewaretoken: window.CSRF_TOKEN,
				reservation_id: $(this).attr('id'),
				get_details: "True"},
			datatype: 'json',

			success: function(response) {
				if (response.status) {
					console.log(response.reservation.date_booked)
					console.log(response.reservation.date_of_reservation)
					d = new Date(response.reservation.date_booked);
					$("#reserve-booking").val(d.toISOString().slice(0, 16));
					d = new Date(response.reservation.date_of_reservation)
					$("#reserve-date").val(d.toISOString().slice(0, 10));
					$("#reserve-time").val(d.toISOString().slice(11, 16));

					$("#reserve-num-persons").val(response.reservation.persons);

					$("#reserve-name").val(response.reservation.name);
					$("#reserve-phone").val(response.reservation.phone);
					$("#reserve-email").val(response.reservation.email);
					
					if (response.reservation.status == "P") {
						$("#reserve-status").html('<i class="fa fa-clock-o"></i> Pending').addClass('text-warning').removeClass('text-success').removeClass('text-danger');
            $("#cancel-reservation-btn, #confirm-reservation-btn").show();
					} else if (response.reservation.status == "R") {
						$("#reserve-status").html('<i class="far fa-check-circle"></i> Reserved').addClass('text-success').removeClass('text-warning').removeClass('text-danger');
            $("#cancel-reservation-btn").show();
            $("#confirm-reservation-btn").hide();
					} else if (response.reservation.status == "C") {
						$("#reserve-status").html('<i class="far fa-times-circle"></i> Cancelled').addClass('text-danger').removeClass('text-success').removeClass('text-warning');
            $("#cancel-reservation-btn").hide();
            $("#confirm-reservation-btn").show();
					}

					$("#cancel-reservation-btn, #confirm-reservation-btn").attr('reservation-id', response.reservation.id);
          $("#reserveModal #r-id").text('(' + response.reservation.id + ')');
					
					$("#reserveModal").modal('show');

				} else if (!response.status) {

				}
			},

			error: function (jqXHR, exception) {

				}
			})
		})

    // cancel the reservation
		$("#cancel-reservation-btn").click(function () {
			$.ajax({
			type: "POST",
			url: "/reservation/cancelReservation/",
			data: {
				csrfmiddlewaretoken: window.CSRF_TOKEN,
				reservation_id: $(this).attr('reservation-id'),
				cancel_reservation: "True"},
			datatype: 'json',

			success: function(response) {
				if (response.status) {
					$("#reserveModal").modal('hide');
					$("#table-reservation tbody tr#" + response.reservation_id + " td:last-child").html('<span><i class="far fa-times-circle"></i></span> Cancelled').removeClass('text-success').removeClass('text-warning').addClass('text-danger');
					
					// updating the counter
          updateOverview();
				} else if (!response.status) {
					// showing notify modal
					$("#notify-modal #notifyTitle").html("Cancellation Failed");
					$("#notify-modal .modal-body").html("Cannot Cancel Reservation . . .<br>The reservation can only be cancelled if there is more than 1 hour remaining for the reservation time.<br>Sorry for the inconvenience");
					$("#notify-modal").modal("show");
				}
			},

			error: function (jqXHR, exception) {

				}
			})
		});


    // confirm the reservation
		$("#confirm-reservation-btn").click(function () {
			$.ajax({
			type: "POST",
			url: "/reservation/confirmReservation/",
			data: {
				csrfmiddlewaretoken: window.CSRF_TOKEN,
				reservation_id: $(this).attr('reservation-id'),
				confirm_reservation: "True"},
			datatype: 'json',

			success: function(response) {
				if (response.status) {
					$("#reserveModal").modal('hide');
					$("#table-reservation tbody tr#" + response.reservation_id + " td:last-child").html('<span><i class="far fa-check-circle"></i></span> Reserved').addClass('text-success').removeClass('text-warning').removeClass('text-danger');
					
					// updating the counter
          updateOverview();
				} else if (!response.status) {
					// showing notify modal
					$("#notify-modal #notifyTitle").html("Confirmation Failed");
					$("#notify-modal .modal-body").html("Cannot Confirm Reservation . . .<br>Sorry for the inconvenience");
					$("#notify-modal").modal("show");
				}
			},

			error: function (jqXHR, exception) {

				}
			})
		});


    // show details of order when cicked on the row
    $("#table-order tbody tr").on('click', function () {
      $.ajax({
				type: "POST",
				url: "/order/get-order/",
				data: {
					csrfmiddlewaretoken: window.CSRF_TOKEN,
					order_id: $(this).attr('id'),
					getOrder: "True",
				},
				dataType: 'json',

				success: function (response) {
					if (response.status) {
						order = response.order;
						if (order.status == "D") {
							$('#confirm-order-btn, #cancel-order-btn, #deliver-order-btn', "#orderModal").hide();
							$("#orderModal #delivery-status").html('<span><i class="far fa-check-circle"></i></span> Delivered').addClass("text-success").removeClass('text-muted').removeClass('text-warning').removeClass('text-danger');
						} else if (order.status == "N") {
							$('#deliver-order-btn, #cancel-order-btn', '#orderModal').show();
							$('#orderModal #confirm-order-btn').hide();
							$("#orderModal #delivery-status").html('<span><i class="far fa-times-circle"></i></span> Confirmed, Not Yet Delivered').addClass("text-muted").removeClass('text-success').removeClass('text-warning').removeClass('text-danger');
						} else if (order.status == "P") {
							$('#confirm-order-btn, #cancel-order-btn', "#orderModal").show();
							$('#orderModal #deliver-order-btn').hide();
							$("#orderModal #delivery-status").html('<span><i class="fa fa-clock-o"></i></span> Pending').addClass("text-warning").removeClass('text-success').removeClass('text-muted').removeClass('text-danger');
						} else if (order.status == "C") {
							$('#deliver-order-btn, #cancel-order-btn', '#orderModal').hide();
							$('#orderModal #confirm-order-btn').show();
							$("#orderModal #delivery-status").html('<span><i class="far fa-times-circle"></i></span> Cancelled').addClass('text-danger').removeClass("text-muted").removeClass('text-success').removeClass('text-warning');
						}
						
						// order details section of order modal
						$('#orderModal table tbody').html('');
						order.items.forEach(item => {
							var tr = '<tr align="center"> '+ 
										'<td>' + item.name + '</td>' +
										'<td><span>' + item.quantity + '</span></td>' +
										'<td>' + item.quantity + ' &times; ' + item.price + '</td>' +
										'<td>' + item.amount + '</td>' +
									'</tr>'
							$('#orderModal table tbody').prepend(tr);
						});

						$('#orderModal table tbody').append(
							'<tr align="center">' + 
								'<td colspan="3" align="right" class="pr-5" style="font-weight: bolder;">Total Amount :</td>' +
								'<td>&#8377; ' + order.amount + '</td>' +
							'</tr>'
						);


						// delivery details section of order modal
						$('#orderModal #personName').val(response.order.name);
						$('#orderModal #order-phone').val(response.order.contact);
						$('#orderModal #order-email').val('{{ request.user.email }}');
						$('#orderModal #order-address').val(response.order.address);


						$("#cancel-order-btn, #confirm-order-btn, #deliver-order-btn", '#orderModal').attr('data', response.order.id);
						$("#orderModal #o-id").text('(' + response.order.id + ')')
						$("#orderModal").modal('show');
					} else {
					}
				},

				error: function (jqXHR, exception) {
				}
			});
    })


    // ajax for cancelling order
		$("#orderModal #cancel-order-btn").click(function () {
			$.ajax({
				type: "POST",
				url: "/order/cancel-order/",
				data: {
					csrfmiddlewaretoken: window.CSRF_TOKEN,
					order_id: $(this).attr('data'),
					cancelOrder: "True",
				},
				dataType: 'json',

				success: function (response) {
					if (response.status) {
						$("#orderModal").modal('hide');
						$("#table-order tbody tr#" + response.order_id + " td:last-child").html('<span><i class="far fa-times-circle"></i></span> Cancelled').addClass('text-danger').removeClass('text-warning').removeClass('text-success');
						
            // updating the counter
            updateOverview();
					} else if (!response.status) {
					}
				},

				error: function (jqXHR, exception) {
				}
			});
			return false;
		});
    
    
    // ajax for confirming order
		$("#orderModal #confirm-order-btn").click(function () {
			$.ajax({
				type: "POST",
				url: "/order/confirm-order/",
				data: {
					csrfmiddlewaretoken: window.CSRF_TOKEN,
					order_id: $(this).attr('data'),
					confirmOrder: "True",
				},
				dataType: 'json',

				success: function (response) {
					if (response.status) {
						$("#orderModal").modal('hide');
						$("#table-order tbody tr#" + response.order_id + " td:last-child").html('<span><i class="far fa-check-circle"></i></span> Confirmed').addClass('text-success').removeClass('text-warning').removeClass('text-danger');
						
            // updating the counter
            updateOverview();
          } else if (!response.status) {
					}
				},

				error: function (jqXHR, exception) {
				}
			});
			return false;
		});
    
    // ajax for delivering order
		$("#orderModal #deliver-order-btn").click(function () {
			$.ajax({
				type: "POST",
				url: "/order/deliver-order/",
				data: {
					csrfmiddlewaretoken: window.CSRF_TOKEN,
					order_id: $(this).attr('data'),
					deliverOrder: "True",
				},
				dataType: 'json',

				success: function (response) {
					if (response.status) {
						$("#orderModal").modal('hide');
						$("#table-order tbody tr#" + response.order_id + " td:last-child").html('<span><i class="far fa-check-circle"></i></span> Delivered').addClass('text-success').removeClass('text-warning').removeClass('text-danger');
						
            // updating the counter
            updateOverview();
          } else if (!response.status) {
					}
				},

				error: function (jqXHR, exception) {
				}
			});
			return false;
		});


    // updating overview section
    function updateOverview() {
      $.ajax({
				type: "POST",
				url: "get-counts/",
				data: {
					csrfmiddlewaretoken: window.CSRF_TOKEN,
					get_counts: "True",
				},
				dataType: 'json',

				success: function (response) {
					if (response.status) {
            // updating the counter
            $("#orders-delivered span").text(response.orders_delivered);
            $("#orders-pending span").text(response.orders_pending);

            $("#upcoming-reservations span").text(response.reservations_confirmed)
            $("#tables-booked span").text(response.tables_booked)
					} else if (!response.status) {
					}
				},

				error: function (jqXHR, exception) {
				}
			});
    }
    $(document).ready(updateOverview());

    
    // show offer details in modal
    $("#table-offers tbody tr").on('click', function () {
      $.ajax({
			type: "POST",
			url: "getOffer/",
			data: {
				csrfmiddlewaretoken: window.CSRF_TOKEN,
        id: $(this).attr('id'),
				get_offer: "True"},
			datatype: 'json',

			success: function(response) {
				if (response.status) {
          var element = $("#edit-offer-modal #edit-offer-form");

          $(element).attr("coupon-code", response.offer.coupon_code);
          $('#code', element).val(response.offer.coupon_code);
          $('#title', element).val(response.offer.title);
          $('#desc', element).val(response.offer.desc);
          $('#discount', element).val(response.offer.discount_percent);
          $('#expiry_date', element).val(response.offer.expiry_date);
          $('#offer-cat', element).val("Main");
          $('#offer-items', element).multiselect('deselectAll', false).multiselect('select', response.offer.items);

          $("#edit-offer-modal").modal("show")

				} else if (!response.status) {

				}
			},

			error: function (jqXHR, exception) {

				}
			});
      return false;
    });


    // Update offer details
    $("#edit-offer-form").submit(function () {
      var prev_code = $(this).attr("coupon-code");
      $.ajax({
			type: "POST",
			url: "updateOffer/",
			data: {
				csrfmiddlewaretoken: window.CSRF_TOKEN,
        prev_code: prev_code,
        new_code: $('#code', this).val(),
        title: $('#title', this).val(),
        desc: $('#desc', this).val(),
        items: JSON.stringify($('#offer-items', this).val()),
        discount: $('#discount', this).val(),
        expiry_date: $('#expiry_date', this).val(),
				update_offer: "True"},
			datatype: 'json',

			success: function(response) {
				if (response.status) {
          var tr = $("#table-offers tbody tr#" + prev_code);
          $(tr).attr('id', response.offer.coupon_code);
          $('.code', tr).text(response.offer.coupon_code);
          $('.discount', tr).text(response.offer.discount_percent + ' %');
          $('.items', tr).text(response.offer.items);
          if (response.offer.is_expired) {
            $('.expiry_date', tr).html('<span><i class="fa fa-times"></i></span> Expired').addClass('text-danger').removeClass('text-success');
          } else {
            $('.expiry_date', tr).html('<span><i class="fa fa-check"></i></span> ' + response.offer.expiry_date).addClass('text-success').removeClass('text-danger');
          }
          $("#edit-offer-modal").modal("hide")

				} else if (!response.status) {

				}
			},

			error: function (jqXHR, exception) {

				}
			});
      return false;
    });

    // Delete offer
    $("#edit-offer-form #delete").click(function () {
      var code = $('#edit-offer-form').attr("coupon-code");
      $.ajax({
			type: "POST",
			url: "deleteOffer/",
			data: {
				csrfmiddlewaretoken: window.CSRF_TOKEN,
        coupon_code: code,
				delete_offer: "True"},
			datatype: 'json',

			success: function(response) {
				if (response.status) {
          console.log(response.code)
          $("#table-offers tbody tr#" + response.code).remove();
          $("#edit-offer-modal").modal("hide")

				} else if (!response.status) {

				}
			},

			error: function (jqXHR, exception) {

				}
			});
      return false;
    });


    // add offer pending ..............-----------------------------------

  </script>

</body>

</html>